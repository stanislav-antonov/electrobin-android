<!doctype html>
<html>
    <head>
        <title>Route</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script src="http://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
        <meta name="viewport" content="width=device-width,height=device-height, user-scalable=no" />
        <script type="text/javascript">
            var myMap;
            var locationArrow;
            var coordSystem;

            var snapDistanceThreshold = 0.0017;
            var routeDeviationThreshold = 5;
            var routeDeviationCount = 0;
            var routePointStep = 4;

            var avoidTrafficJams;

            var routePoints;

            var currentRouteData;
            var currentRoute;

            var prevPosition;

            ymaps.ready(function () {
                var initCoords = [55.53638053374438,37.529385721565184];
                myMap = new ymaps.Map('map', {
                    center: initCoords,
                    zoom: 16,
                    geoObjectOverlayFactory: 'default#interactiveGraphics',
                    // controls: ["zoomControl", "searchControl", "trafficControl"]
                    controls: ["trafficControl"]
                });

                coordSystem = myMap.options.get('projection').getCoordSystem();

                var trafficControlButton = myMap.controls.get("trafficControl");
                trafficControlButton.events.add('select', function () {
                        avoidTrafficJams = true;
                        updateStartPoint();
                        _displayRoute(true);
                    }).add('deselect', function () {
                        avoidTrafficJams = false;
                        updateStartPoint();
                        _displayRoute(false);
                    }
                );

                Android.onMapReady();
            });


            function updateStartPoint() {
                if (prevPosition && currentRouteData && currentRouteData.hasOwnProperty("start_point")) {
                    var startPoint = currentRouteData["start_point"];
                    startPoint.latitude  = prevPosition[0];
                    startPoint.longitude = prevPosition[1];
                }
            }


            function routeToPoints(route) {
                var points = [];
                var prevSegment, currSegment;

                var paths = route.getPaths();
                for (var jj = 0; jj < paths.getLength(); jj++) {
                    var path = paths.get(jj);
                    var segments = path.getSegments();
                    for (var i = 0; i < segments.length; i++) {
                        var segment = segments[i].getCoordinates();
                        for (var j = 0; j < segment.length; j++) {
                            currSegment = segment[j];
                            if (prevSegment && prevSegment[0].toPrecision(10) === currSegment[0].toPrecision(10) && prevSegment[1].toPrecision(10) === currSegment[1].toPrecision(10)) {
                                continue;
                            }

                            points.push(currSegment);
                            prevSegment = currSegment;
                        }
                    }
                }

                var result = [];
                for (var i = 0, l = points.length - 1; l; --l, ++i) {
                    var from = points[i],
                        to = points[i + 1],
                        diff = [to[0] - from[0], to[1] - from[1]];

                    for (var j = 0, k = Math.round(coordSystem.distance(from, to)); j < k; j += routePointStep) {
                        var ratio = j / k;
                        result.push([from[0] + (diff[0] * ratio), from[1] + (diff[1] * ratio)]);
                    }
                }

                return result;
            }


            function snapToRoute(point) {
                if (!point) return null;
                if (!routePoints) {
                    console.log('no route points!');
                    return [point[0], point[1]];
                }

                var minDistance = null;
                var distance = null;
                var rpFound;

                for (var i = 0; i < routePoints.length; i++) {
                    var rp = routePoints[i];

                    var distance = Math.sqrt(Math.pow((point[0] - rp[0]), 2) + Math.pow((point[1] - rp[1]), 2));
                    if (minDistance == null) {
                        minDistance = distance;
                    }

                    if (distance < minDistance) {
                        minDistance = distance;
                        rpFound = rp;
                    }
                }

                if (minDistance < snapDistanceThreshold) {
                    return rpFound ? [rpFound[0], rpFound[1]] : null;
                } else {
                    if (routeDeviationCount > routeDeviationThreshold) {
                        routeDeviationCount = 0;
                        Android.onRouteDeviation();
                    }

                    routeDeviationCount++;

                    return [point[0], point[1]];
                }
            }


            function calcBearing(lat1, lon1, lat2, lon2) {
                var latitude1 = lat1 * Math.PI / 180;
                var latitude2 = lat2 * Math.PI / 180;
                var longDiff = (lon2 - lon1) * Math.PI / 180;
                var y = Math.sin(longDiff) * Math.cos(latitude2);
                var x = Math.cos(latitude1) * Math.sin(latitude2) - Math.sin(latitude1) * Math.cos(latitude2) * Math.cos(longDiff);

                return (Math.atan2(y, x) * (180 / Math.PI) + 360) % 360;
            }


            function updatePosition(lat, long, bearing) {
                var pointSnapped = snapToRoute([lat, long]);
                if (!pointSnapped) return;

                var b = 0;
                if (prevPosition) {
                    b = calcBearing(prevPosition[0], prevPosition[1], pointSnapped[0], pointSnapped[1]);
                }

                prevPosition = pointSnapped;

                myMap.panTo([pointSnapped]).then(
                    function () {
                        if (!locationArrow) {
                            locationArrow = new ymaps.Placemark(
                                pointSnapped, {}, {
                                    iconLayout: 'default#image',
                                    iconShadow: false,
                                    iconImageHref: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZEAYAAAAFm1TsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAHD1JREFUeNrsXWlUW+eZfu53L0LGWGAZMBCMAbOIxSwG7wYct0lbZ2nruHaayeLJJI0dB2daZ9r+yfR0zsmZ6UmTM51O6swkmU6apB1vYBbj3WwCYxsv7DJgjDHGIGMBQhZCElfz49NFYhPCkQDb9/3zHW33Xn330aP3e97lYywWi8VigdPGMAzDMBBtCuvv7+/v79+8mT7q6/Px8fHx8amoEGfGsU0Xj4Jx4tS507KyrLDuo6MIZHcZIzKyO5g4Kpo+utZIx2GejmHhlJlvd4gz5VpGJuLUucPe2W392Vvnl7P+8+18S5wbkZEfAiZeIKOPbt+io/BYsLtqOi5ZSpl5yCDOnMjIc9B27JgYwIL5B9Bx+zZxrlxrIpBdwsSCCyG4FMDly9VXW1qmcj1EE4E8p+x7T9MxOlqj6dUMaIHf/OaDf/3LV8BddU+PoFnYbOUq+gNYs0acOxHIc8h2jzBsTnZ+QUUFMGgwGIxGIDs7L0+pnOxze7LEuROBPAdcimWR9NEzmwf1FLh5+YXHzp23va/g6PET5y8COt193aB+7FG2bqXHCQoWZ1QE8iyaTWY7Wnj8+PlK4L5erzfYaRECMx8tOHHywoWxn/eQ0FGU5UQgzwoTe3vTR6+/PmweNvM8cPhwXr6y3A6iXEbG008BAAMGwOGc3FxlOWA2m83D5rFH3bmTHlciEWdYBPIM2quv0lEmKy4uU1ZfBe729PT0awFC/P0W+wMsl7Q8LQ1gybLImBhAo+ntG9ABp08XF1+5OvZ4AVZZ7ieiLCcCeSaYWJDZskYWafsPZueUltrex5K01HXr7B5zK1LW2mkTBw/m5JSWARbewlv4sWfJEmU5EcgzYZs20VGhqKq6crm5CWhtbWu70w0wWOi7SA6wXGRkbJzdBJPFAUHBACEhIWFLgZvttzrUauD8haoqlWrs8VevoT+YVavEuRaB7EazyWUHDmbnlNgxMcelpq5bO/knOW5Fir1qvH//aCYfw8yiLCcC2R0uRXgEffTcsy0tra2dncDly9U1LdcBBgu8ZTKA5WKi4xMcTDRZGhoRATBYJPf3A2rr6htu3ARUqqamW+1j3719Gz3v4kDxDohAdqHZZLYDB7NzSopHMe2KNaspVIkTs8lxyUmrVo5m5pJxzDwiy+0U514EsguYeP6IzNbdpVb3aoDiYqWyth5gME863wtgufj45GTnj8tyMYqEBNvnlcpzFfX1wO2OO533esa+e+dboiwnAtkF9srLdPT1PZyde0SpBHie53keYLmUFZRZWcJNq86GJSwHsFxi4ooUwAILLAAOHTpypGxcKDvQ6lps2SLeCxHI38qlGNDqdIN6oPDYqTMXLwEMPCVSKcBxy+NXrHjwI7Nk+fLUNNsP4cSpM0VVl4D+vv6++7rJF5miiUCehkvxpFVmi0/IyyssPFcJGKyhZpZLTExNAQCJxFP64OdhyDyplxfAkujouFjAaDQazWYg50hBwfjKvrXr6HVR6IsmAtlJ25MlAOtIbsHRinN0mebBASxJTnKlystyicvT7OApJB0NGYYMJqPIzCKQH4iJw8Loo+efP3266Ozly0BvX1+fTgdwXEJCSgrAEKl0npcLbwAJCAgMBAgJDHwiCNBqB3R6PXDs+OnTF6vGvvvFF+l1CiFt0UQgT2hv76KhY0IOHDySW1pmXZwRgCUpSe6Mt7Ekcbm943Do8JFcZbltcUlNUC/eEmU5EcgTMbGXlWPfeONc5YULjSqgo+N2Z08PwBKFYvlygCHe3jKZG4HMRUbGKmyyXFdXt1qjAcpKKyrq6sa+W5DlPERZTgSyvb30Eh0XyvfvP2wNeND0S45LTV07IwVJgiyXkJCcZHt2bFIStWBrIv6PfyTeOxHIdpaVVV+nUt1sA+obVKqbtwCWREXHxgIM8ZEtlM/clbAkwSrr0UhhU1NLS8dt4OrV2prrLeOvW7x3jzmQ6V9z5kb6KDHxwBjm47jUFPt0zJkyhnh7L5ABLAkPi1pme/7AhMy8YQP9HikrRCA/1rYn61b77Y67aqCi4nxlQyNASFhY5DKAIX5+s6kNsFxSkr0sd+HCpcvXmoG2tptt3V3jv4cI5MeSiUND6aMfPn/wMA0NC6FijluZun7dHLgx5IngpWEAA7nc38/OZ96fc2R8ktFPrbKcf4AI5MfK3t7Vq+nr0+lY7tTJs0WXr1iBs8Sq54a489wWjK8Mmdw4LjExNdX2uKi4pKS6emy/DCHG+OYbIpAfCyaWWm/4G28csYaCTWaT2WwGOG50iZL7mHZQbzROx8VQxCQkAIAH58EBZvMwP8wDOUfy88orxv9A6ffkOBHIj7T99CXaf2KRX15+4bFz56ylSIsBQkJDhfR59wLZYBgyTucTHpxEQlWUuFjbswVHj584fx64r7NvPyD8l/zoRyKQH/HF3fHjp05evAAM6HS6QQMtFl2/YSavgectPMASGvp2npkTRmXb6fWDhiEjUFBA+2mMtsdPlnvkgUz/atMzaP+J5ORDh3PzleV0EeXnB7BcRER0tOvOFxzs5eW4UoTqwx6SbnWvZjpMLhSx0nYDgmXn5OWXnxvbLyMjg37vpGQRyI+UZe0uKVUqa2qAbrVa3dtn1YnXuu4MUinLMQDWrQ0I8HDoodKWAoQMDg4ZAZbQJCGnmZnEJ9irxvc0Go1WO1m/jMdHlntkgUwZKcTqM27ZcuBgTm5pKcBAJvP1pSVH8XGuO9+aNf5+HAcs9PWUMg5m1cKPru3zkHR3TYeZWS4mii7+aFqpYIcOH8ktKx3bL+Oll+g8LPITgfxQ265dtE8xy7W0tLZ23qFMvHY1ADBgXPjtN2YGBXtIgPt6s3k68hohuvuDBoCQ+6N6xk1uEol18RcZa7f4a2trb+++aw2cNNn+J+j46MtyjxyQKQPZdFWh6pnBfC9vb4DlYuOWJ7rufAu8PSQMgJTkRXKOE5ZyjhwL2ituvDbR3aWZFjMnxKdM4AFPnGT06Mtyjygjv/hia2tb251O/4CqqitXm68DLJec/GDFoo5tw/rFAR4SgOUov2u1RuMDbIEBltMO6PUAIYMGZ3YWEQI3DBbJ7UPpNTV1da03gGuq5qaOkb2jllgjmc89LwL5obI9WUInHwZS6TxaLLo81Q2pNU9uCgq291UHBkxTuBYW8A5e9+C6u3r7nD8/Nybt056Z7ftvPOqLv0cGyPSvc906tfquuq9vxYri4rLS6lqA5ZIS01IpRFyZhu7vJ5USAsQqfH1ZOyBrtSaHjMxgYtfCxsx9/TodwGDIaHIicMJyipjl1sWf/T9NWWlFRV090NnZ1WXrl7FxI50nVzpXIpDdwsTZ2fkF5UpgmCeE42gJUZobao8zMwMDPTiMWzD29g0ZeYeMbDbzTiwGPSTOMjOt5mZJZKQixp73bf0yxm/98Oh1/XzogUwZJjiYbm3wwlZhqwOOS0hISXJ9segIkDMCAyfytdVqg8GRa8EQmisxtcvQ2z+gBRjQau6pmTk2JmkCnj1+4vSZi5eA/j6t1tYv4+WX6bzJ5SKQ55S99VZ+3rHjlZUcZzCYjMNmgCWju1+6ykJD53sTAoRHLJDZuxQazZDBwgMGw7DZsWsxUcf6CX1p3gLAQ3K3p88JZiYkJISmfcpkPna1hUJbg9y8owXnRkLZ80ZqFEUgzwkmlkhMRpPRbN61Myc3P7/iHMCS2LikJIAhXl5C5zaXMnF6UOBEkbuurkGDMy4DQ0zG4Wmlcd6719/n/A+A5Wix7FgT+nMMGYx2vrcgy7GcCORZte0vnj5dXHzlsn+ARtOvva8f34fYVSbsWpy5MTBwokVjZ6de7xSQYTKbppX9xvM04d85ZmaJIiZxAhdD6Jdx/Pipk1Uj/TKWhtHx2WdFIM+S0VBs1u4DB3NyS8topCvOWizq6+v688UofHxZAgQGzpswKaitTacbnkJ2s/AAQ0ym6TCyjZl77vVrAWCYd8TMwvcXCgXG2qHDufll4/plPPyy3EMHZGHH0MrKi1Uq1cpVtzo6Ou72uD8xPjM9KNCRfHfjxoDWESM7u2hzsEg08zzgwd3r0WqdYebY2ImY+U5XVxftl3Guon6kX8amTXReHbUqF4HsBsvK2m/d+oAlERHRUQBDaFqmyyeIUIEtPWNxoKOsthttAzpHTEnIkMFo/PbXw3FqNXUx7Bl1Il85MlKhAITE/LG2/+DhCRqMP7yy3EMDZGErgoYGlaq9fdu2urqGhrabAOtmJk5KlMs5DvD1lUgmSjIS1IopAyFkyGgyf/vrYYh5eJgHOE6jGXDIzDQANFZfFkzol1FTU1fX2io8+8qrdJ4XykUgu9V27jxwMCentJTjCFkSEr6UJpwHu3ED3I3WwMdk1tjQr3XGZSDE4BJGtsGU5lVPVczKchO7GCPMvN8+lC20Dnv9dRHIbmFiieRWe0fHXfXuXeXKysr6evf7xBIJXdKtXRcQ4CjJ6FpTX58zizdXA5khRhMtmu3VOCqZIuSJ4NBQgIGPbOEEi+DzF6qqaL+M9nZbv4x3dtN5J0QEsktt69bs7Pw8pdI/gCGLA4ODbAEAd9nKNP8ADw7w8uI4R3nLqmv9fcNOMfLgoCuBbO8zOxPKnkxfFuzgwZxsW/qn0F73mWdFILvI7vVoNFrt3r0nTp0punRl5sr2MzMnDkELZrJmVLS0aLWOGNnGxI4XZw++GDUMGY1TF7OyJCbGUUXMmbPFJVergZ4ee1Xk4Vn8zVkgCzuA5uUdK6ysXLHCZFzgLZcDhISHRUW777zzvTiOAbBqlZ+fI7mtUdXXZzYDxilShJzNL/7WPvMUxaxCM0ZCAgODg8a/LvTLyM7OL7AlGT31NL0PsXEikB/Q6CY0776bf7TwWOV5KxOvdf95161dHMhxAMc59g9rano1zrkU93WGGQCyrZjVPjloImaOjk5woBYL/TL0er3e9gOc+8w854AsbC1w5mxx8ZWr27cNaAnxlAAsFxUdq5gBl2KSEPRYu3Spp8c5tcLZWjxXMbOgM092PdFRdB6ZkbC7ven1ev1Iv4wLwrOvWmU5H18RyE4azdba9fahw0dyy8pYjuNSU9eutU68G69WLveUMgCSEhf6OvKNezVGo4UHWloGHIakGQzzPE992CHjDN7QkWJW3YRtBhgyTzrfGyBkSWh4+OTHyc7Jz1eWC/0ybBtnikB2iok9JKWlFRW1Ne9mdXfp9WYzwHKxisQZqGcQau8YMvHP5XYHTQr6/Ue1NYOGqVsREnJfN6gHMK2WhS5kZs4xM7MkJsrR4q+n555GqwXOni0tvXpVeHbuynJz7IJe2JKdk5evVC6Us1xK8upp7PH8rV2KjNGBj/s6Wtb/2X9fUxkMwO6sigqdDqiu0WicS3Qf0A0aZm8mbcWs9/WD+oleXxYZowDGlkiNNaHBOE3SirB2x/vBZhHIk1hFxfnKhob3329uut3R2w9wXPyE5e6utiBrNltUtEzGcsCxwo4OoxF4402lUqcDcvPb241GYHrdKqZedM0cM99V92snfoX2xwgPi46a/PP2/TKamubu4m/WgSxsHVBw9PiJ85VxcSyXlLzSDcWik9lCuaeEAbDn3cpKnQ74ZF9jg8EADOhMD1TWL+jGDBkackVuxbdnZqGYddAw0aKT5RzryzZmzrFLMvre9+l9i1GIQLYa3eTlN+9fuFBbd+MmwHFJbikWncwaGmiIua1Np3NFwIIl/VqdDnPOPCR31ROlfxISGhoRYdtjezKrrqmta71hTTbqsPnMjz2Qha0Cjh07daaq6tlnOW55giv2eJ5tG+ZlsvlewKA+JmZJCGAwREeFhABDhvDwoEDAZFy8eKEvwPNe8zxncJc8WzGrYUyAhm6LRkh4ROSyqY+zf//hw7Ykox076H105w6EcxzI9Jf93t6S0nMVDY0s5+o9nmfLeH6e1FMKWEBHnvfykkqBYd5HNt8bMJmDAhf5AQZDdPSSUGBQr4hZEgKYjIGL5XLAwnt6erilgk4oZr2nGdBNuPgLVzjhKJQpz1XWNwJ3Oru6NBpvqyz3968/dkAWepCdPHn27OXLb79t4WMUCfHuKxad62aBVOopBUzmwEC5HBg0xCqWhgEGQ1RUSAhgMgb4+/oCFl7i4YpWX0IxK8bUDhKyNIxqEhMn4tt+qDRn5NCh3CNlpTYXY7ZluRk/MU3HfPnlk6eKiq5c8fbmuNSUtesg2jjAzPeSSgGTOTjYzw8YNMTFhU0C8OkxOC1mHa9msNaGNkvDIsKnPsrxE6fOVI30y4iMpM8+/fRjA+QTJ8+crqr65/eHDKGhUVHu3+P5cQA4ZfCYUS4Kz0s9HTErx93rpYs/s9leFyckcpkzLsaQ0Wg0mYG8vMLCypF+GbNXxDpjQG5pvn69/WZa2qlTxSVXq8Mj3FW2//gCfN4oF8VgUChCQwGDITY2NBQwGYOCFslti0yhmJXj7Lc5A1huaeiyCOsi0Al0jO6X8X2rLOfO/MRZBvKx46dOXqz6+KO+voXyoCD3FYvOmq/LGwyDeoDn29tbW4Fhc6OqtgYYNre2NjUBFl6nc6b62fUA95RIJIDJvDhgodx+kRkfHxYGWHhP6WiViKpGU+VijKx5tFrtfT1w4uTp01VVQnh/5mU5xmKxWCzTUP4ZhmEYxvn337nTdUfd7ef3TtZ7//TJPnV3V9f69c89wxBC/P0WBz6MgL2v1+kAnr9+XaUChvnmlsYGgOfvdHbcpss3R9MpbGZDyLJIhQJgrX/lDFnoO5c2SBg2NzRUXwVM5jNFR49N/f7g4MDARXLgyz//17739g5oGcIQhjyxxMfHx8fHZ8Dpn/B08TjiKrl7QvLyjhaeq/z9hx0dhHjPZ4hE8nAAWGDQYb75OgVqS4tKBfB8d1fnHcBHJpN5eQHp6WvXJsQD69f97M2nngYUiujoJSHAApm39zwvW17vNVVz060OoLyisrKhASgqUpZXXQL6tZWVJWW0Ybe/dZepmBiAJVFRsQqAIYvks7ExLyFLw5ZFOv/+zs6urnsaoExZUVFXt0CWkbF+w/LEHTvoq3/8j4eWkQWZ7d13f/mrfX/SDTS3xMWmZ3hKhWLIuQPYfm1fHzDMt4wAtlEF8Lxa3dUNLPD29p4nBdZvWLM6Ph7ITN+wITERSE1LTo6MpClNDyI6CTJW9dXamtZWoKS0vKK2BigtKy+vrbe1uGLg6yuXAyy3LCImCiAkKio2jjJ74AwQwpDhr3/7/AvAgnsatXrq98dER0WGPAF88slHH73zjpCdoYilzDx1vsqDMrLbgPz5Z19+WZD/y19+9sWxY9U1v/udRLL1hVdfnU3A9vbd66GAVamAYXNLS+M1wIKeHrUa8PLy8vKUAOvWrVoVFwtkpm9Yn5gIrFyVuiI6GuA4lpu61Z+gzF60dle7Ye0YIUywkD220hqEH59NYjYPm4fNwJXL1TXXW4GSMrqtWrmy8nx9vW2jS6HrJssti1DEULWBAjww0JXtEcxmZfmZ04DZfOXq+YvOf+7jj/71g7feBBIT4xPCI773PQrkkycfOiDv3PnuP378kbq7ti50SWqafwAhS0MjImYCsPc0d9XAMN/c3KgChs3XW1XXAAs0mp4eQCqVSiUSYM2alWmKGGBjJgXs6lVpaQoF4CHxkDgfeBCq2776io4HDtAbNnkm8Oi+xNtfpOOrr9Bxch2Hdh0FqqquXG1uAkrKlOU1NUBFxYULDY22yg4GC7xlMtppKNYFAB82X29VqQCTufBYdo7zn1u9Ki1NEQN88ME/v79jR0EBnZfnnntogPzpvi++OJKzefOfvzx+orrm6FGJZPtP3FFXMB6wLS2NjYAFvX33NHQTL44DVq1KXWEP2LVrVq+JVQCeUonE+ey6lhY6fv0NHf/yF3pjbrS66vuMlq1e/js6vvIyHSffJVvof3y+sqpKpQJKysqtAD9/oaHR9vqDAtzC63QDWmDI+Ocv//jJ9L/X55/95x9//q6FXxZhMjaqVq72kBQXf/ihSuXp+Yu9SuX4RNc5A+Q9e/7pl//xh/r6qir5QoUiLo7loiK/TQ0uz9/t6eqiKsE1K2Apw1LAchzHsQRIS0tJjo4CNmampycmAuvXrVkTnwDM86IM7JwJG4Tt/z8r035DAXuuYqZdIQpsQc4SGiAIzL1tGx0n7ztKN48HKioqK+vrgLNFpWXVNUBV1ZXLTc3AME9LsZwFuMHwyb5/+53g3Tv/Pb7//e9+Jy0VeG/vnj1bt/77v0ulX3z+zDO//S19VSqlgO7qmjNA/vDDP/zhb3+Lij6SW1amutZ0jZAXt7/xDw8C2ObmxgZ7wPZre/toqSQDIDl5eWJEOLDpycz05GRgwwYK2AWyBTIvp7dYEFqlFBZaGdbqGhy1/gUajZijNnofQaGv8StWBt+8eTLfW7AB7YBWr7ctLouKysqqa2gPuBs3bHuPCAAnJCIiJgoY5mvrLl2ZPpA5jgZWvv7q889+9asBrZ/fIj+ZLPgJCmihqjDI+pPp65NIfv6LsrLplyS4DMg//8Wvf/2ffzx54nzl/PnhEU89PVmt3VSAFSwuTqEIXQJsejIjPTkZyMygasFCua+v97STiwRG/eobgXEpYKezRePcNgpwIcQk+N6vWRl85ZR5hbQRDlBcXFZaUwMUlZSVV18FVKqmplu3v/31bf/Jlh9npgNv/mzHjh9s3r2bzv+f/jSijgx9/NGGDR4SCmSTccaBvP3F13b8y2/ne6vVg/phi7bfbH7hhR2vEcLzajUF7I0bzU2TAzYyMiIiOAjYmJm+PikR2LQpIyMpGQgI8A+YfsNuwWf96mvBp6UT1tyEx9QowIXsiR2vWRn8VSGM4ZQ+3AMUnS0prq4BikqU5dVXgba2m+3dd52/jvleNJ31r9/8zxe//lVT03xvLy+pdLwsN2uuBfWJP91XWdnQ0HH7rZ2AyWgyAxYMGe1La5aEPBHs7wc8+WRGelIS8OTG9IykRGBJaEjI9AV/Idh78AAd//dLOpZXOKtXPt7AFpTv7353NMB/vEXwXac6Ds1iBEpKy5U1NUBRUWlZdS1ws/1WhyO9+Wdv/v1rm38AbNv24y0ZGd99it6vM6dnDcgrV2Vu3PU2IYvkcrlMphu4p9FotNp5Xv5+fn4+MuA738lMT04CNm5Mz0hKtjLvtOUfwRs7dXK0L5tzhE7ARPXBoj04wIUGLD/ZOhrg6zc4/594s62rCygupvp3aZmyvLYWuNVxu/NuDyDg43///Om+9/YWFAQs9vf387fJcjMO5A8++PDDr77asmWhr6+vt/fhw2vWUB122QMBVrCGBjp+aWXYr7+mgO3sFKE2mwAXZEFhUSmEtpzvhzoW4CtXpayIjrbwCQlxcWFhy6IEOXPGgUy/4Kf76LNv7ZzeaYVNZf/6V4Fp6Rex7Tck2sPgmmzcOFoW3GJ1TRZMM8P844/p/d+7d8aArNVqtVqt0Jq/4xYdJxO+hNXn0cLRTHu0kF64yShC41ECuLAR5Q+ftzK4FeBC5chkMVMhEhqyRCaTyWSyGZDfKJD3vkcf/f7D0a8KjCoA9v+sMldPj3irH2eAC8v57dZAjhC5XD0mJL9rFwXyp5/OEJC/seqxNbXWxVc2BWxTk3jrRJu+7/13P6VjygoK5B/+cLrH+/8BAAu7nhm1CLgGAAAAAElFTkSuQmCC',
                                    iconImageSize: [32, 32],
                                    iconImageOffset: [-16, -16],
                                    iconOffset: [0, 0],
                                }
                            );

                            myMap.geoObjects.add(locationArrow);
                        }
                        else {
                            locationArrow.geometry.setCoordinates(pointSnapped);
                        }

                        locationArrow.getOverlay().then(function (value) {
                            var $ico = $(value.getIconElement());
                            $ico.css('transform', 'rotate(' + b + 'deg)');
                        }, function (err) {
                            console.log('Ошибка: ' + err);
                        });
                    },
                    function (err) {},
                    this
                );
            }


            function displayRoute(routeJSON) {
                currentRouteData = $.parseJSON(routeJSON);
                _displayRoute();
            }


            function _displayRoute() {
                if (!currentRouteData) {
                    console.log('no route data!');
                    return;
                }

                var wayPointsData = [];
                var hasStartPoint = false;

                if (currentRouteData.hasOwnProperty("start_point")) {
                    var startPoint = currentRouteData.start_point;
                    wayPointsData.push({ type: "wayPoint", point: [ startPoint.latitude, startPoint.longitude ] });
                    hasStartPoint = true;
                }

                var wayPoints = currentRouteData.way_points;
                for (i = 0; i < wayPoints.length; i++) {
                    var wayPoint = wayPoints[i];
                    wayPointsData.push({ type: "wayPoint", point: [ wayPoint.latitude, wayPoint.longitude ] });
                }

                if (currentRoute) {
                    myMap.geoObjects.remove(currentRoute);
                }

                Android.onRouteBuildingStart();

                ymaps.route(wayPointsData, {avoidTrafficJams: avoidTrafficJams, mapStateAutoApply: true}).then(
                    function(route) {
                        var points = route.getWayPoints();

                        var startPoint = null;
                        if (hasStartPoint) {
                            startPoint = points.get(0);
                            points.remove(startPoint);
                        }

                        points.each(function (point, i) {
                            var uniqueId = wayPoints[i].unique_id;
                            point.properties.set("unique_id", uniqueId);
                            point.properties.set("iconContent", "75");

                            // https://tech.yandex.ru/maps/doc/jsapi/2.1/ref/reference/GeoObject-docpage/
                            point.options.set("iconLayout", "default#imageWithContent");
                            point.options.set("iconImageHref", 'data:image/png;base64,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');
                            point.options.set("iconImageSize", [35, 41]);
                            point.options.set("iconImageOffset", [0, 0]);
                            point.options.set("iconOffset", [-17, -40]);
                            point.options.set("iconContentOffset", [10, 10]);
                            point.options.set({
                                hasBalloon: false
                            });

                            point.events.add("click", function () {
                                Android.onRoutePointClick(point.properties.get("unique_id"));
                            });
                        });

                        if (hasStartPoint && startPoint != null) {
                            // var startPointPlacemark = new ymaps.Placemark(startPoint.geometry.getCoordinates(), {}, {
                            //    hasBalloon: false,
                            //    iconColor: "0066ff99"
                            // });
                            // points.add(startPointPlacemark, 0);
                        }

                        myMap.geoObjects.add(route);
                        routePoints = routeToPoints(route);
                        currentRoute = route;

                        Android.onRouteBuildingReady();
                    },
                    function (error) {
                        alert(error.message);
                    }
                );
            }
        </script>
        <style>
            html, body, #map {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #map {
                background-color: black;
            }

            #button {
                position: absolute;
                height: 20px;
                top: 10px; left: 10px;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
    </body>
</html>